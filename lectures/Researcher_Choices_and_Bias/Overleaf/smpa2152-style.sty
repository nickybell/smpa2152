% timer styles heavily borrowed from https://github.com/dominik-probst/latex-beamer-timer
\ProvidesPackage{smpa2152-style}

% --- CORE BEAMER SETTINGS ---
\mode<presentation>
\usetheme{Boadilla}

% --- REQUIRED PACKAGES ---
% It's best practice to load all required packages within the style file.
% hyperref and xcolor are loaded automatically by the beamer class.
\RequirePackage{graphicx}
\RequirePackage{tabularx}
\RequirePackage{amsmath,amssymb}
\RequirePackage{listings}
\RequirePackage{animate}
\RequirePackage{adjustbox}
\RequirePackage{tikz}

% --- FONT SETTINGS ---
% Sets the font to Montserrat
\RequirePackage[defaultfam,tabular,lining]{montserrat}
% Capital case titles
\setbeamerfont{title}{shape=\scshape}
\setbeamerfont{frametitle}{shape=\scshape}

% --- COLOR DEFINITIONS & THEME ---
% Define custom color for the theme
\definecolor{GWdarkblue}{HTML}{033C5A}
% Apply the color to the beamer structure (headlines, etc.)
\usecolortheme[named=GWdarkblue]{structure}

% Define colors for the timer animation
\definecolor{background}{RGB}{255, 255, 255}
\definecolor{mainfont}{HTML}{414851}
\definecolor{secondaryfont}{HTML}{C9D0D5}
\definecolor{timeleft}{HTML}{89B2BB}
\definecolor{timepassed}{HTML}{E4E8E2}
\definecolor{timeelapsed}{HTML}{EDDFDB}

% --- LAYOUT & TEMPLATE MODIFICATIONS ---
% Remove the "Figure" prefix from captions for a cleaner look
\setbeamertemplate{caption}{\raggedright\insertcaption\par}

% --- CUSTOM LENGTHS FOR TIMER ---
% These lengths control the size of the circular timer.
\newlength{\outerradius}
\newlength{\innerradius}
\newlength{\boundarybox}
\newlength{\textboundary}
\setlength{\outerradius}{2cm}
\setlength{\innerradius}{1.5cm}
\setlength{\boundarybox}{3cm}
\setlength{\textboundary}{3cm}

% --- CUSTOM COMMANDS FOR TIMER CALCULATION ---
% Calculates the minutes part of a total number of seconds.
% Formats the output as a two-digit number (e.g., 5 becomes "05").
\newcommand{\minutes}[1]{%
    \pgfmathparse{mod(floor(#1/60), 60)}%
    \pgfmathtruncatemacro{\minval}{\pgfmathresult}%
    \ifnum\minval<10 0\fi\minval%
}

% Calculates the seconds part of a total number of seconds.
% Formats the output as a two-digit number (e.g., 9 becomes "09").
\newcommand{\seconds}[1]{%
    \pgfmathparse{mod(#1, 60)}%
    \pgfmathtruncatemacro{\secval}{\pgfmathresult}%
    \ifnum\secval<10 0\fi\secval%
}

% --- CUSTOM COMMAND FOR THE TIMER ---
% Creates a timer animation that lasts for a specified number of minutes.
% Usage: \inserttimer{<minutes>}
\newcommand{\inserttimer}[1]{
	\begin{center}
            \pgfmathtruncatemacro{\totalSeconds}{#1*60}
		\begin{animateinline}[controls={play, stop}, autoplay, poster=first]{1}
			\multiframe{\totalSeconds}{n=0+1}{
				\begin{tikzpicture}
					% Macros
					\pgfmathsetmacro{\timeleft}                    {(#1*60)-\n}
					\pgfmathsetmacro{\percentage}                  {\timeleft/(#1*60)*100}
					\pgfmathsetmacro{\angle}                       {\timeleft/(#1*60)*360}

					% Boundary box
					\fill[background] (-\boundarybox,-\boundarybox) rectangle (\boundarybox,\boundarybox);
					% Progress indicating circle
					% Lower layer circle (representing time passed)
					\fill[timepassed] (0,0) circle (\outerradius);
					% Middle layer circle (representing time left)
					\fill[timeleft] (0,0) -- (90:\outerradius) arc (90:\angle+90:\outerradius) -- cycle;
					% Upper layer circle (freeing up space within the outer circle for text)
					\fill[background] (0,0) circle (\innerradius);
					% Text
					% Text within the progress indicating circle
					% Header
					\node[text width=\textboundary,align=center] at (0,.75) {\small \textcolor{secondaryfont}{Time left:}};
					% Time left
					\node[text width=\textboundary,align=center] at (0,0) {\LARGE \textcolor{mainfont}{\minutes{\timeleft}min \seconds{\timeleft}sec}};

					% Text below the progess indicating circle
					\node at (0,-2.5) {\textcolor{secondaryfont}{Controls:}};
				\end{tikzpicture}
			}
			\newframe[1]
			\begin{tikzpicture}
				% Boundary box
				\fill[background] (-\boundarybox,-\boundarybox) rectangle (\boundarybox,\boundarybox);

				% Progress indicating circle
				% Lower layer circle (representing time passed)
				\fill[timepassed] (0,0) circle (\outerradius);
				% Middle layer circle (representing time left)
				\fill[timeelapsed] (0,0) -- (0, \outerradius) arc (90:90-3.6*100:\outerradius) -- (0,0);
				% Upper layer circle (freeing up space within the outer circle for text)
				\fill[background] (0,0) circle (\innerradius);
				% Text
				% Text within the progress indicating circle
				% Header
				\node[text width=\textboundary,align=center] at (0,0) {\LARGE \textcolor{mainfont}{Time \\elapsed}};
				% Text below the progess indicating circle
				\node at (0,-2.5) {\textcolor{secondaryfont}{Controls:}};
			\end{tikzpicture}
		\end{animateinline}
	\end{center}
}

% --- END OF STYLE FILE ---
\endinput
